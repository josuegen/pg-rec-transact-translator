-- Workaround code generated by Google GSD
{obj_action} PROCEDURE {obj_schema}.{obj_name}(
    {obj_parameters}
)
LANGUAGE 'plpgsql'
AS $BODY$
DECLARE
v_sql text;
v_con_count int;
v_con_name text;
BEGIN
v_con_name := 'myconn';
    -- Prepare for autonomous transaction by opening the DB link and sending the transaction across the link.
    -- Check if the link is already open for the session
    SELECT count(1) INTO v_con_count FROM dblink_get_connections() 
    WHERE dblink_get_connections@>'{{myconn}}';
        
    -- Open the dblink if if is not open.
    IF v_con_count = 0 THEN
        PERFORM dblink_connect(v_con_name, 'loopback_link');
    END IF;
        
    -- Prepare the statement to execute across the link
    v_sql := format('CALL {obj_schema}.xx_{obj_name}( {formatted_obj_parameters_names} )'{obj_parameters_names});

    -- Send the statement across the link
    PERFORM dblink_exec( v_con_name,  v_sql);
        
END;
$BODY$;